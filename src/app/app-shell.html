<link rel="import" href="../../bower_components/polymer/polymer-element.html">

<link rel="import" href="login-component.html">

<dom-module id="app-shell">
  <template>
    <style>

      body{
          margin: 0;
          padding: 0;
      }
      .post__main_content{
          display: flex;
          align-items: center;
          justify-content: center;
          height: 100vh;
          background: linear-gradient(0deg, lime 80%, aqua 80%);
      }
      .page{
          display: flex;
          align-self:flex-end;
          width:100%;
          height: 90vh;
          max-width: 900px;
      }
      .post__aside{
          padding: 24px 0 20px 8px;
          width: 240px;
          min-width: 240px;
          overflow-y:auto;
      }
      .page__content{
          display: flex;
          flex-direction: column;
          flex-grow:2;
          padding: 18px 8px;
          margin: 0 8px 0 18px;
          color:#fafafa;
          border-radius: 8px 8px 0 0;
          background: #F633FF;
      }
      .post__list{
          flex-grow: 2;
          overflow-y: auto;
          color:#333;
          /*background:aqua;*/
      }

      .container {
        display: flex;
        justify-content: center;
        padding-top: 50px;
      }

      .posts {
        display: none;
      }

      .container.sessionActive {
        display: none;
      }

      .container.sessionActive + .posts {
        display: block;
      }
      .current__user_name{
        font-size: 1.4em;
      }

    </style>

    <div class="container" id="showPosts">
      <loader-spinner id="loader_spinner" paused></loader-spinner>
      <login-component
        on-check-user="_checkUser" users="{{allUsers}}">
      </loginComponent>
    </div>

    <div class="posts">
      <div class="post__main_content">
          <!-- PAG -->
          <div class="page">
              <aside class="post__aside">
                  <user-list id="user_list" list="[[allUsers]]" on-user-selected="_userSelected"></user-list>
              </aside>
              <div class="page__content">
                  <template is="dom-if" if="[[showForm]]">
                    <div>EL FORMULARIO</div>
                  </template>
                  <hr>
                  <div>Post de <strong class="current__user_name">[[selectedUser.name]]</strong></div>
                  <hr>
                  <div class="post__list">
                      <post-list id="post_list" list="[[selectedUser.posts]]"></post-list>
                  </div>
              </div>
          </div>
          <!-- END PAG -->
      </div>
    </div>

  </template>
  <script>
    (function appShell(customElements) {

      'use strict';

      class AppShell extends Polymer.Element {
        static get is() { return 'app-shell'; }
        static get properties() {
          return {
            sessionUser: {
              type: Object
            },
            slectedUser: {
              type: Object
            },
            allUsers: {
              type: Array
            },
            showForm:{
              type:Boolean,
              computed: '_showForm(sessionUser, selectedUser)'
            }
          };
        }

        _checkUser(event) {
          let user = event.detail.data.filter(users => {
            let hasUser;
            try{
              hasUser = users.email === event.detail.useremail ? ( users.password === event.detail.password ? true : false ) : false;
            }catch(err){ hasUser = false; }
            return hasUser
          });
          if (user.length) {
            this.sessionUser = user[0];
            this.selectedUser = user[0];
            this.$.user_list.selectedId = user[0].email;
            this.$.showPosts.classList.toggle('sessionActive');
            console.info('allUsers', this.allUsers);
          } else {
            alert('Usuario o password incorretco');
          }
        }

        _userSelected(event) {
          console.info('userElected');
          this.selectedUser = this.allUsers.filter(item => item.email === event.detail.email)[0];
        }

        _showForm(sessionUser,selectedUser ) {
          let show = false;
          try{
            console.info('Show Form', this.sessionUser.email, this.selectedUser.email );
            show = this.sessionUser.email === this.selectedUser.email? true : false; }catch(err){}
          return show;
        }

      } // end

      //this.$.loader_spinner.setAttribute('paused', true);
      //this.$.showPosts.classList.toggle('sessionActive');

      customElements.define(AppShell.is, AppShell);

    })(window.customElements);
  </script>
</dom-module>

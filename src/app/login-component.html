<link rel="import" href="../../bower_components/polymer/polymer-element.html">

<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">

<dom-module id="login-component">
  <template>
    <style>

      :host {
        --color-iron-icon: hsl(0, 0%, 50%);
        --button-session: #FFFFFF;
      }

      .card__title {
        text-align: center;
        color: #36528C;
      }

      .alig__card {
        display: flex;
        justify-content: center;
      }

      paper-card {
        padding: 90px;
        bottom: 150px;
      }

      iron-icon, div[suffix] {
        color: var(--color-iron-icon);
        margin-right: 12px;
      }

      .session__personal {
        background-color: #F04A58;
        color: var(--button-session);
      }
      paper-button.full{
        display: block;
        width:100%;
        text-align: center;
      }

    </style>

    <!-- url="/src/app/data/userdata.json" -->
    <!-- url="https://posts-services.herokuapp.com/users" -->
    <iron-ajax
      id="http"
      url="https://posts-services.herokuapp.com/users"
      handle-as="json"
      on-response="_handleResponse"
      debounce-duration=300>
    </iron-ajax>

    <div class="alig__card">
      <paper-card>
        <div class="card-content">
          <h2 class="card__title">HOLA BIENVENIDO</h2>
          <p class="card__title">{{useremail}}</p>
          <paper-input
            label="Useremail"
            type="email"
            auto-validate
            value="{{useremail}}"
            required
            auto-validate
            error-message="The email is required"
            on-invalid-changed="_validate">
            <iron-icon
              icon="icons:account-circle"
              slot="prefix">
            </iron-icon>
          </paper-input>
          <paper-input
            type="password"
            label="Password"
            auto-validate
            value={{password}}
            required
            error-message="The password is required"
            on-invalid-changed="_validate">
            <iron-icon
              icon="icons:lock"
              slot="prefix">
            </iron-icon>
          </paper-input>
        </div>
        <div class="card-actions">
          <div class="button__space">
            <paper-button
              id="loginButton"
              on-click="login"
              class="session__personal full"
              raised
              disabled>
              Entrar
            </paper-button>
          </div>
        </div>
      </paper-card>
    </div>

  </template>
  <script>
    (function loginComponent(customElements) {

      'use strict';

      class LoginComponent extends Polymer.Element {
        static get is() { return 'login-component'; }
        static get properties() {
          return {
            useremail: {
              type: String,
              value: 'Gage.Bogisich@hotmail.com'
            },
            password: {
              type: String,
              value: 'azj8P1s_Sd3uSfW'
            },
            users: {
              type: Array,
              value: [],
              notify:true,
              reflectToAttribute:true
            }
          };
        }

        login() {
          console.info("Si llegue");
          this.$.http.generateRequest();
          this.dispatchEvent(new CustomEvent('login-submit', {
            bubbles: true,
            composed: true
          }));
        }

        _validate(event) {
          if (this.useremail !== '' && this.password !== '') {
            this.$.loginButton.removeAttribute('disabled');
            this.$.loginButton.classList.add('session__personal');
          } else {
            this.$.loginButton.setAttribute('disabled', 'true');
            this.$.loginButton.classList.remove('session__personal');
          }
        }

        _handleResponse() {
          this.set('users', this.$.http.lastResponse.filter(item => item !== null));
          this.dispatchEvent(new CustomEvent('check-user', {
            bubbles: true,
            composed: true,
            detail: {
              useremail: this.useremail,
              password: this.password,
              data: this.users
            }
          }));
        }

        clean() {
          this.useremail = '';
          this.password = '';
        }

      }

      customElements.define(LoginComponent.is, LoginComponent);

    })(window.customElements);
  </script>
</dom-module>
